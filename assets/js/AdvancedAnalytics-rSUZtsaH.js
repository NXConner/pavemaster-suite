import{u as he,r as i,R as _,j as e,i as n,C as E,ad as F,k as r,l as P,m as b,n as je,q as V,t as $,v as z,w as B,x as l,y as fe,Q as c,g as W,Y as x,b as S,U as C,e as J,T as G,ae as H,a3 as pe,a4 as ve,a5 as f,aa as I,V as d,W as o,A as q,af as Ne,s as ge,ag as ye}from"./index-ChsUsUzn.js";import{D as we}from"./download-5NXVcGla.js";import{C as be}from"./chart-line-CqXOcTrx.js";import{C as K}from"./chart-pie-BBZuVBDM.js";import{B as Se}from"./building-DJ8xM28B.js";import{G as Ce}from"./gauge-DH-nFCV6.js";const Oe=()=>{const{user:R}=he(),[p,Y]=i.useState(null),[t,Q]=i.useState(null),[M,X]=i.useState({}),[k,Z]=i.useState([]),[T,ee]=i.useState("30d"),[A,se]=i.useState("all"),[g,te]=i.useState(!0),[y,ae]=i.useState(60),[O,ne]=i.useState(!1),[ce,ie]=i.useState(!0),[Re,Te]=i.useState(!1),[Ae,De]=i.useState(["financial","productivity","workforce"]),v=i.useRef();i.useEffect(()=>{(async()=>{if(!R)return;const{data:m,error:j}=await ge.from("profiles").select("role").eq("id",R.id).single();j||Y(m?.role)})()},[R]),i.useEffect(()=>(p&&["super_admin","admin","manager"].includes(p)&&(U(),g&&L()),()=>{v.current&&clearInterval(v.current)}),[p,T,A,g,y]);const L=()=>{v.current&&clearInterval(v.current),v.current=setInterval(()=>{U()},y*1e3)},U=async()=>{try{await Promise.all([re(),le(),de()])}catch{_({variant:"destructive",title:"Error fetching analytics",description:"Unable to load analytics data. Please try again."})}},re=async()=>{Q({financial:{revenue:125e4,costs:89e4,profit:36e4,profitMargin:28.8,trend:"up"},productivity:{efficiency:87.3,utilization:82.1,completionRate:94.5,averageTaskTime:4.2,trend:"up"},workforce:{totalEmployees:145,activeEmployees:134,attendanceRate:96.2,overtimeHours:287,satisfactionScore:8.4},projects:{total:23,completed:18,inProgress:4,overdue:1,completionRate:78.3},equipment:{total:67,operational:61,maintenance:4,utilization:89.2,downtime:3.1},safety:{incidentCount:2,safetyScore:94.7,complianceRate:98.1,nearMisses:7,trainingCompletion:92.3}})},le=async()=>{const s={revenue:h("revenue",30),costs:h("costs",30),productivity:h("productivity",30),workforce:h("workforce",30),projects:h("projects",30),safety:h("safety",30)};X(s)},h=(s,m)=>{const j=[],w={revenue:4e4,costs:28e3,productivity:85,workforce:92,projects:78,safety:94}[s]||50;for(let N=m;N>=0;N--){const u=new Date;u.setDate(u.getDate()-N);const ue=w+(Math.random()-.5)*w*.2;j.push({date:u.toISOString().split("T")[0],value:Math.round(ue*100)/100,category:s})}return j},de=async()=>{Z([{id:"revenue_growth",name:"Revenue Growth",value:12.7,target:15,unit:"%",trend:"up",change:2.3,status:"good",category:"financial"},{id:"cost_efficiency",name:"Cost Efficiency",value:71.2,target:75,unit:"%",trend:"up",change:1.8,status:"warning",category:"financial"},{id:"employee_productivity",name:"Employee Productivity",value:87.3,target:85,unit:"%",trend:"up",change:3.1,status:"good",category:"productivity"},{id:"project_completion",name:"Project Completion Rate",value:94.5,target:90,unit:"%",trend:"up",change:4.2,status:"good",category:"projects"},{id:"safety_score",name:"Safety Performance",value:94.7,target:95,unit:"/100",trend:"stable",change:-.3,status:"warning",category:"safety"},{id:"equipment_uptime",name:"Equipment Uptime",value:96.9,target:95,unit:"%",trend:"up",change:1.2,status:"good",category:"equipment"},{id:"customer_satisfaction",name:"Customer Satisfaction",value:4.6,target:4.5,unit:"/5",trend:"up",change:.2,status:"good",category:"quality"},{id:"inventory_turnover",name:"Inventory Turnover",value:8.3,target:10,unit:"x",trend:"down",change:-.7,status:"critical",category:"operations"}])},oe=s=>{const m={analytics:t,kpis:k,charts:M,exportedAt:new Date().toISOString(),timeRange:T,department:A},j=JSON.stringify(m,null,2),w=new Blob([j],{type:"application/json"}),N=URL.createObjectURL(w),u=document.createElement("a");u.href=N,u.download=`analytics-${s}-${new Date().toISOString().split("T")[0]}.json`,u.click(),_({title:"Export Complete",description:`Analytics data exported as ${s.toUpperCase()}`})},a=(s,m)=>O?m:s,xe=s=>{switch(s){case"good":return"text-green-600";case"warning":return"text-yellow-600";case"critical":return"text-red-600";default:return"text-gray-600"}},D=s=>{switch(s){case"up":return e.jsx(S,{className:"h-4 w-4 text-green-500"});case"down":return e.jsx(ye,{className:"h-4 w-4 text-red-500"});default:return e.jsx(q,{className:"h-4 w-4 text-gray-500"})}},me=s=>{switch(s){case"financial":return e.jsx(W,{className:"h-4 w-4"});case"productivity":return e.jsx(S,{className:"h-4 w-4"});case"projects":return e.jsx(J,{className:"h-4 w-4"});case"safety":return e.jsx(G,{className:"h-4 w-4"});case"equipment":return e.jsx(H,{className:"h-4 w-4"});case"workforce":return e.jsx(C,{className:"h-4 w-4"});case"quality":return e.jsx(Ce,{className:"h-4 w-4"});case"operations":return e.jsx(Se,{className:"h-4 w-4"});default:return e.jsx(q,{className:"h-4 w-4"})}};return!p||!["super_admin","admin","manager"].includes(p)?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs(n,{className:"p-8 text-center",children:[e.jsx(E,{className:"h-16 w-16 mx-auto mb-4 text-muted-foreground"}),e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Analytics Access Restricted"}),e.jsx("p",{className:"text-muted-foreground",children:a("Management access required for Advanced Analytics","Command authorization required for Strategic Intelligence")})]})}):t?e.jsxs("div",{className:"min-h-screen p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{className:"h-8 w-8 text-primary"}),e.jsx("h1",{className:"text-3xl font-bold",children:a("Advanced Analytics","Strategic Intelligence Center")})]}),e.jsx(r,{variant:"outline",className:"animate-pulse",children:"Live Data"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(F,{className:`h-4 w-4 ${g?"animate-spin":""}`}),e.jsxs("span",{children:["Last update: ",new Date().toLocaleTimeString()]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{id:"military-jargon",checked:O,onCheckedChange:ne}),e.jsx(b,{htmlFor:"military-jargon",className:"text-xs",children:a("Military","Tactical")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{id:"auto-refresh",checked:g,onCheckedChange:s=>{te(s),s&&L()}}),e.jsx(b,{htmlFor:"auto-refresh",className:"text-xs",children:"Auto-Refresh"})]}),e.jsxs(je,{variant:"outline",onClick:()=>oe("csv"),children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Export"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between bg-muted/50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(V,{value:T,onValueChange:ee,children:[e.jsx($,{className:"w-40",children:e.jsx(z,{})}),e.jsxs(B,{children:[e.jsx(l,{value:"7d",children:"Last 7 Days"}),e.jsx(l,{value:"30d",children:"Last 30 Days"}),e.jsx(l,{value:"90d",children:"Last 90 Days"}),e.jsx(l,{value:"1y",children:"Last Year"})]})]}),e.jsxs(V,{value:A,onValueChange:se,children:[e.jsx($,{className:"w-48",children:e.jsx(z,{})}),e.jsxs(B,{children:[e.jsx(l,{value:"all",children:"All Departments"}),e.jsx(l,{value:"operations",children:"Operations"}),e.jsx(l,{value:"finance",children:"Finance"}),e.jsx(l,{value:"hr",children:"Human Resources"}),e.jsx(l,{value:"safety",children:"Safety & Compliance"}),e.jsx(l,{value:"equipment",children:"Equipment"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{id:"predictions",checked:ce,onCheckedChange:ie}),e.jsx(b,{htmlFor:"predictions",className:"text-sm",children:a("Show Predictions","Tactical Forecasts")})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(b,{className:"text-sm",children:["Update Interval: ",y,"s"]}),e.jsx(fe,{value:[y],onValueChange:s=>ae(s[0]),min:30,max:300,step:30,className:"w-24"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4",children:[e.jsx(n,{children:e.jsxs(c,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:a("Total Revenue","Mission Revenue")}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",(t.financial.revenue/1e3).toFixed(0),"K"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[D(t.financial.trend),e.jsx(W,{className:"h-8 w-8 text-green-500"})]})]}),e.jsx(x,{value:t.financial.revenue/15e5*100,className:"mt-2"})]})}),e.jsx(n,{children:e.jsxs(c,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:a("Productivity","Operational Efficiency")}),e.jsxs("p",{className:"text-2xl font-bold",children:[t.productivity.efficiency,"%"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[D(t.productivity.trend),e.jsx(S,{className:"h-8 w-8 text-blue-500"})]})]}),e.jsx(x,{value:t.productivity.efficiency,className:"mt-2"})]})}),e.jsx(n,{children:e.jsxs(c,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:a("Active Workforce","Active Personnel")}),e.jsx("p",{className:"text-2xl font-bold",children:t.workforce.activeEmployees})]}),e.jsx(C,{className:"h-8 w-8 text-purple-500"})]}),e.jsx(x,{value:t.workforce.activeEmployees/t.workforce.totalEmployees*100,className:"mt-2"})]})}),e.jsx(n,{children:e.jsxs(c,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:a("Project Success","Mission Success")}),e.jsxs("p",{className:"text-2xl font-bold",children:[t.projects.completionRate,"%"]})]}),e.jsx(J,{className:"h-8 w-8 text-orange-500"})]}),e.jsx(x,{value:t.projects.completionRate,className:"mt-2"})]})}),e.jsx(n,{children:e.jsxs(c,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:a("Safety Score","Risk Assessment")}),e.jsx("p",{className:"text-2xl font-bold",children:t.safety.safetyScore})]}),e.jsx(G,{className:"h-8 w-8 text-red-500"})]}),e.jsx(x,{value:t.safety.safetyScore,className:"mt-2"})]})}),e.jsx(n,{children:e.jsxs(c,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:a("Equipment Uptime","Asset Operational Status")}),e.jsxs("p",{className:"text-2xl font-bold",children:[t.equipment.utilization,"%"]})]}),e.jsx(H,{className:"h-8 w-8 text-gray-500"})]}),e.jsx(x,{value:t.equipment.utilization,className:"mt-2"})]})})]}),e.jsxs(pe,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(ve,{className:"grid w-full grid-cols-6",children:[e.jsx(f,{value:"overview",children:a("Overview","Situation Report")}),e.jsx(f,{value:"financial",children:a("Financial","Resource Analysis")}),e.jsx(f,{value:"operations",children:a("Operations","Mission Status")}),e.jsx(f,{value:"workforce",children:a("Workforce","Personnel")}),e.jsx(f,{value:"predictive",children:a("Predictive","Intelligence")}),e.jsx(f,{value:"custom",children:a("Custom","Command View")})]}),e.jsxs(I,{value:"overview",className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:k.map(s=>e.jsx(n,{children:e.jsxs(c,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[me(s.category),e.jsx("h4",{className:"text-sm font-medium",children:s.name})]}),D(s.trend)]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-end space-x-2",children:[e.jsx("span",{className:"text-2xl font-bold",children:s.value}),e.jsx("span",{className:"text-sm text-muted-foreground",children:s.unit})]}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("span",{children:["Target: ",s.target,s.unit]}),e.jsxs("span",{className:xe(s.status),children:[s.change>0?"+":"",s.change,"%"]})]}),e.jsx(x,{value:s.value/s.target*100,className:"h-1"})]})]})},s.id))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(n,{children:[e.jsx(d,{children:e.jsxs(o,{className:"flex items-center space-x-2",children:[e.jsx(be,{className:"h-5 w-5"}),e.jsx("span",{children:a("Revenue Trend","Financial Performance")})]})}),e.jsx(c,{children:e.jsx("div",{className:"h-64 bg-muted rounded flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(E,{className:"h-12 w-12 mx-auto mb-2 text-primary"}),e.jsx("p",{className:"text-sm font-medium",children:"Revenue Trend Chart"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[M.revenue?.length||0," data points"]})]})})})]}),e.jsxs(n,{children:[e.jsx(d,{children:e.jsxs(o,{className:"flex items-center space-x-2",children:[e.jsx(K,{className:"h-5 w-5"}),e.jsx("span",{children:a("Cost Breakdown","Resource Allocation")})]})}),e.jsx(c,{children:e.jsx("div",{className:"h-64 bg-muted rounded flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(K,{className:"h-12 w-12 mx-auto mb-2 text-primary"}),e.jsx("p",{className:"text-sm font-medium",children:"Cost Distribution"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Labor: 60% | Materials: 25% | Equipment: 15%"})]})})})]}),e.jsxs(n,{children:[e.jsx(d,{children:e.jsxs(o,{className:"flex items-center space-x-2",children:[e.jsx(S,{className:"h-5 w-5"}),e.jsx("span",{children:a("Productivity Metrics","Operational Efficiency")})]})}),e.jsx(c,{children:e.jsx("div",{className:"h-64 bg-muted rounded flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(q,{className:"h-12 w-12 mx-auto mb-2 text-primary"}),e.jsx("p",{className:"text-sm font-medium",children:"Productivity Dashboard"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Efficiency: ",t.productivity.efficiency,"%"]})]})})})]}),e.jsxs(n,{children:[e.jsx(d,{children:e.jsxs(o,{className:"flex items-center space-x-2",children:[e.jsx(C,{className:"h-5 w-5"}),e.jsx("span",{children:a("Workforce Analytics","Personnel Metrics")})]})}),e.jsx(c,{children:e.jsx("div",{className:"h-64 bg-muted rounded flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(C,{className:"h-12 w-12 mx-auto mb-2 text-primary"}),e.jsx("p",{className:"text-sm font-medium",children:"Workforce Overview"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.workforce.activeEmployees,"/",t.workforce.totalEmployees," Active"]})]})})})]})]})]}),e.jsx(I,{value:"financial",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(n,{children:[e.jsx(d,{children:e.jsx(o,{children:"Revenue Analysis"})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Revenue"}),e.jsxs("span",{className:"font-bold",children:["$",t.financial.revenue.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Costs"}),e.jsxs("span",{className:"font-bold",children:["$",t.financial.costs.toLocaleString()]})]}),e.jsx(Ne,{}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Net Profit"}),e.jsxs("span",{className:"font-bold text-green-600",children:["$",t.financial.profit.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Profit Margin"}),e.jsxs("span",{className:"font-bold",children:[t.financial.profitMargin,"%"]})]})]})})]}),e.jsxs(n,{children:[e.jsx(d,{children:e.jsx(o,{children:"Cost Efficiency"})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold",children:"71.2%"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Current Efficiency"})]}),e.jsx(x,{value:71.2,className:"h-2"}),e.jsx("div",{className:"text-xs text-center text-muted-foreground",children:"Target: 75%"})]})})]}),e.jsxs(n,{children:[e.jsx(d,{children:e.jsx(o,{children:"ROI Analysis"})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:"24.7%"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Return on Investment"})]}),e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Equipment ROI:"}),e.jsx("span",{children:"18.2%"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Training ROI:"}),e.jsx("span",{children:"31.5%"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Technology ROI:"}),e.jsx("span",{children:"42.1%"})]})]})]})})]})]})}),e.jsx(I,{value:"operations",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs(n,{children:[e.jsx(d,{children:e.jsx(o,{children:"Project Status"})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Projects"}),e.jsx(r,{children:t.projects.total})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Completed"}),e.jsx(r,{variant:"outline",className:"text-green-600",children:t.projects.completed})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"In Progress"}),e.jsx(r,{variant:"outline",className:"text-blue-600",children:t.projects.inProgress})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Overdue"}),e.jsx(r,{variant:"destructive",children:t.projects.overdue})]})]})})]}),e.jsxs(n,{children:[e.jsx(d,{children:e.jsx(o,{children:"Equipment Status"})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Equipment"}),e.jsx(r,{children:t.equipment.total})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Operational"}),e.jsx(r,{variant:"outline",className:"text-green-600",children:t.equipment.operational})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"In Maintenance"}),e.jsx(r,{variant:"outline",className:"text-yellow-600",children:t.equipment.maintenance})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Utilization Rate"}),e.jsxs(r,{variant:"outline",children:[t.equipment.utilization,"%"]})]})]})})]}),e.jsxs(n,{children:[e.jsx(d,{children:e.jsx(o,{children:"Safety Metrics"})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Incidents (MTD)"}),e.jsx(r,{variant:t.safety.incidentCount>0?"destructive":"outline",children:t.safety.incidentCount})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Safety Score"}),e.jsx(r,{variant:"outline",className:"text-green-600",children:t.safety.safetyScore})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Compliance Rate"}),e.jsxs(r,{variant:"outline",children:[t.safety.complianceRate,"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Training Complete"}),e.jsxs(r,{variant:"outline",children:[t.safety.trainingCompletion,"%"]})]})]})})]})]})})]})]}):e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx(F,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{children:"Loading analytics data..."})]})})};export{Oe as default};
