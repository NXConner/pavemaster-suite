import{c as O,aA as ae,r as i,j as e,n as r,p as te,a3 as le,a4 as ne,a5 as N,aa as w,i as d,V as o,W as m,Q as h,aL as G,J as P,q as re,t as ie,v as ce,w as de,x as k,aC as oe,aj as A,M as T,k as me}from"./index-ChsUsUzn.js";import{R as he}from"./ruler-7mBX7vXA.js";import{U as B}from"./upload-CgS1LYG4.js";import{S as V}from"./save-CXbdRz1O.js";import{S as xe}from"./square-pen-BhNbn2-E.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=O("Pentagon",[["path",{d:"M10.83 2.38a2 2 0 0 1 2.34 0l8 5.74a2 2 0 0 1 .73 2.25l-3.04 9.26a2 2 0 0 1-1.9 1.37H7.04a2 2 0 0 1-1.9-1.37L2.1 10.37a2 2 0 0 1 .73-2.25z",key:"2hea0t"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=O("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);function Ne(){const{toast:y}=ae(),j=i.useRef(null),I=i.useRef(null),[R,C]=i.useState([]),[n,c]=i.useState(null),[W,f]=i.useState(!1),[l,x]=i.useState([]),[g,z]=i.useState("polygon"),[S,H]=i.useState(1),[M,$]=i.useState(null),[J,E]=i.useState(!1);i.useEffect(()=>{Q()},[]);const Q=async()=>{const s=[{id:"1",name:"Church Parking Lot - Main Area",type:"area",value:12500,unit:"sq ft",method:"gps",projectId:"proj-1",notes:"Main parking area with existing asphalt",createdAt:new Date().toISOString(),materialCalculations:{asphalt:25.5,sealcoat:12.5,striping:850}},{id:"2",name:"Side Parking Strip",type:"area",value:3200,unit:"sq ft",method:"photo",projectId:"proj-1",notes:"Narrow strip along building",createdAt:new Date().toISOString(),materialCalculations:{asphalt:6.5,sealcoat:3.2,striping:220}}];C(s)},X=()=>{const s={id:Date.now().toString(),name:`Measurement ${R.length+1}`,type:"area",value:0,unit:"sq ft",method:"drawing",coordinates:[],createdAt:new Date().toISOString()};c(s),x([]),f(!0)},Y=s=>{if(!W||!j.current)return;const t=j.current.getBoundingClientRect(),u=s.clientX-t.left,se=s.clientY-t.top,v={x:u,y:se};g==="polygon"?x(b=>[...b,v]):g==="rectangle"&&l.length===0?x([v]):g==="rectangle"&&l.length===1&&(x(b=>[...b,v]),U([...l,v])),p()},U=(s=l)=>{if(s.length<3){y({title:"Insufficient Points",description:"Please draw at least 3 points to create an area",variant:"destructive"});return}const a=q(s);if(n){const t={...n,value:a,coordinates:s,materialCalculations:K(a)};c(t),f(!1),E(!0)}},q=s=>{if(s.length<3)return 0;let a=0;for(let t=0;t<s.length;t++){const u=(t+1)%s.length;a+=s[t].x*s[u].y,a-=s[u].x*s[t].y}return a=Math.abs(a)/2,Math.round(a/(S*S)*100)/100},K=s=>({asphalt:Math.round(s*.00204*100)/100,sealcoat:Math.round(s*.001*100)/100,striping:Math.round(Math.sqrt(s)*4*8)}),p=()=>{if(!j.current)return;const s=j.current,a=s.getContext("2d");if(a)if(a.clearRect(0,0,s.width,s.height),M){const t=new Image;t.onload=()=>{a.drawImage(t,0,0,s.width,s.height),L(a)},t.src=M}else L(a)},L=s=>{if(l.length>0){s.strokeStyle="#3b82f6",s.lineWidth=2,s.fillStyle="rgba(59, 130, 246, 0.2)",s.beginPath(),s.moveTo(l[0].x,l[0].y);for(let a=1;a<l.length;a++)s.lineTo(l[a].x,l[a].y);l.length>2&&(s.closePath(),s.fill()),s.stroke(),l.forEach((a,t)=>{s.fillStyle="#3b82f6",s.beginPath(),s.arc(a.x,a.y,4,0,2*Math.PI),s.fill(),s.fillStyle="#ffffff",s.font="12px Arial",s.textAlign="center",s.fillText((t+1).toString(),a.x,a.y+4)})}},Z=s=>{const a=s.target.files?.[0];if(a){const t=new FileReader;t.onload=u=>{$(u.target?.result),setTimeout(p,100)},t.readAsDataURL(a)}},_=()=>{n&&(C(s=>[...s,n]),c(null),x([]),f(!1),E(!1),y({title:"Measurement Saved",description:`${n.name} has been saved successfully`}))},F=s=>{C(a=>a.filter(t=>t.id!==s)),y({title:"Measurement Deleted",description:"Measurement has been removed"})},ee=()=>{x([]),f(!1),c(null),p()};return i.useEffect(()=>{p()},[l,M]),e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Measurements & Area Calculation"}),e.jsx("p",{className:"text-muted-foreground",children:"Measure areas, calculate materials, and estimate costs"})]})]}),e.jsxs(r,{onClick:X,children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"New Measurement"]})]}),e.jsxs(le,{defaultValue:"drawing",className:"space-y-6",children:[e.jsxs(ne,{className:"grid w-full grid-cols-4",children:[e.jsx(N,{value:"drawing",children:"Drawing Tools"}),e.jsx(N,{value:"photo",children:"Photo Measurement"}),e.jsx(N,{value:"gps",children:"GPS Polygon"}),e.jsx(N,{value:"saved",children:"Saved Measurements"})]}),e.jsx(w,{value:"drawing",className:"space-y-6",children:e.jsxs("div",{className:"grid gap-6 lg:grid-cols-4",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsxs(d,{children:[e.jsx(o,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),"Drawing Canvas"]})}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(r,{variant:g==="polygon"?"default":"outline",size:"sm",onClick:()=>z("polygon"),children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Polygon"]}),e.jsxs(r,{variant:g==="rectangle"?"default":"outline",size:"sm",onClick:()=>z("rectangle"),children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Rectangle"]}),e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>I.current?.click(),children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Upload Image"]}),e.jsxs(r,{variant:"outline",size:"sm",onClick:ee,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Clear"]}),l.length>2&&e.jsxs(r,{variant:"default",size:"sm",onClick:()=>U(),children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Complete Area"]})]}),e.jsx("canvas",{ref:j,width:600,height:400,className:"border border-gray-300 rounded-md cursor-crosshair bg-gray-50",onClick:Y}),e.jsx("input",{ref:I,type:"file",accept:"image/*",onChange:Z,className:"hidden"}),l.length>0&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Points: ",l.length," | Current Area: ",q(l)," sq ft"]})]})})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(d,{children:[e.jsx(o,{children:e.jsx(m,{className:"text-sm",children:"Scale Settings"})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Scale (pixels per foot)"}),e.jsx(P,{type:"number",value:S,onChange:s=>H(Number(s.target.value)),className:"mt-1"})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Adjust scale for accurate measurements. Default: 1 pixel = 1 foot"})]})]}),n&&e.jsxs(d,{children:[e.jsx(o,{children:e.jsx(m,{className:"text-sm",children:"Current Measurement"})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Name"}),e.jsx(P,{value:n.name,onChange:s=>c({...n,name:s.target.value}),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Type"}),e.jsxs(re,{value:n.type,onValueChange:s=>c({...n,type:s}),children:[e.jsx(ie,{className:"mt-1",children:e.jsx(ce,{})}),e.jsxs(de,{children:[e.jsx(k,{value:"area",children:"Area"}),e.jsx(k,{value:"length",children:"Length"}),e.jsx(k,{value:"perimeter",children:"Perimeter"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Notes"}),e.jsx(P,{value:n.notes||"",onChange:s=>c({...n,notes:s.target.value}),className:"mt-1",placeholder:"Additional notes..."})]})]})]}),J&&n?.materialCalculations&&e.jsxs(d,{children:[e.jsx(o,{children:e.jsxs(m,{className:"text-sm flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),"Material Estimates"]})}),e.jsxs(h,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Asphalt:"}),e.jsxs("span",{className:"font-medium",children:[n.materialCalculations.asphalt," tons"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Sealcoat:"}),e.jsxs("span",{className:"font-medium",children:[n.materialCalculations.sealcoat," gal"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Striping:"}),e.jsxs("span",{className:"font-medium",children:[n.materialCalculations.striping," ft"]})]}),e.jsxs(r,{onClick:_,className:"w-full mt-4",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Save Measurement"]})]})]})]})]})}),e.jsx(w,{value:"photo",className:"space-y-6",children:e.jsxs(d,{children:[e.jsx(o,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5"}),"Photo-Based Measurement"]})}),e.jsx(h,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(A,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Photo Measurement Tools"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Upload photos and trace areas for automatic measurement calculation"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(r,{children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Take Photo"]}),e.jsxs(r,{variant:"outline",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Upload Aerial Photo"]})]})]})})]})}),e.jsx(w,{value:"gps",className:"space-y-6",children:e.jsxs(d,{children:[e.jsx(o,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5"}),"GPS Polygon Drawing"]})}),e.jsx(h,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(T,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"GPS Area Measurement"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Walk the perimeter with GPS to automatically calculate area"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(r,{children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Start GPS Recording"]}),e.jsxs(r,{variant:"outline",children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Draw on Map"]})]})]})})]})}),e.jsx(w,{value:"saved",className:"space-y-6",children:e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:R.map(s=>e.jsxs(d,{children:[e.jsx(o,{children:e.jsxs(m,{className:"flex items-center justify-between text-lg",children:[e.jsx("span",{children:s.name}),e.jsx(me,{variant:"outline",children:s.method})]})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Area"}),e.jsxs("div",{className:"font-medium",children:[s.value," ",s.unit]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Type"}),e.jsx("div",{className:"font-medium capitalize",children:s.type})]})]}),s.materialCalculations&&e.jsxs("div",{className:"pt-4 border-t space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Material Estimates:"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Asphalt"}),e.jsxs("div",{className:"font-medium",children:[s.materialCalculations.asphalt,"t"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Sealcoat"}),e.jsxs("div",{className:"font-medium",children:[s.materialCalculations.sealcoat,"g"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Striping"}),e.jsxs("div",{className:"font-medium",children:[s.materialCalculations.striping,"ft"]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(r,{variant:"outline",size:"sm",className:"flex-1",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>F(s.id),children:e.jsx(G,{className:"h-4 w-4"})})]})]})]},s.id))})})]})]})})}export{Ne as default};
