import{u as le,r as i,R as re,f as oe,aj as _,ad as B,j as e,i as r,ak as de,M as me,V as xe,W as he,al as $,Q as d,n as E,k as h,a3 as ue,a4 as fe,a5 as N,B as V,o as je,aa as w,m as T,l as I,s as pe,T as z,a8 as ge}from"./index-ChsUsUzn.js";import{M as W}from"./mic-BonLplW2.js";import{B as Ne}from"./battery-ca9Vi5Rc.js";import{D as we}from"./download-5NXVcGla.js";import{U as ve}from"./upload-CgS1LYG4.js";import{W as be}from"./wifi-off-4DfyDpIE.js";import{S as L}from"./signal-CKe4z6kc.js";const Te=()=>{const{user:u}=le(),[ye,H]=i.useState(null),[n,m]=i.useState({isOnline:navigator.onLine,batteryLevel:75,signalStrength:4,gpsEnabled:!1,cameraAvailable:!1,microphoneAvailable:!1,bluetoothEnabled:!1,notificationsEnabled:!1,lastSync:new Date().toISOString(),dataUsage:2.3}),[v,b]=i.useState([]),[l,y]=i.useState([]),[f,q]=i.useState(null),[o,F]=i.useState(!1),[G,R]=i.useState(!1),[j,M]=i.useState(!1),[p,P]=i.useState(!1),S=i.useRef(),x=i.useRef();i.useEffect(()=>{(async()=>{if(!u)return;const{data:t,error:a}=await pe.from("profiles").select("role").eq("id",u.id).single();a||H(t?.role)})()},[u]),i.useEffect(()=>{J(),Y(),K();const s=()=>{m(a=>({...a,isOnline:!0})),O()},t=()=>{m(a=>({...a,isOnline:!1}))};return window.addEventListener("online",s),window.addEventListener("offline",t),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",t),S.current&&navigator.geolocation.clearWatch(S.current)}},[]);const J=async()=>{const s={gpsEnabled:"geolocation"in navigator,cameraAvailable:"mediaDevices"in navigator&&"getUserMedia"in navigator.mediaDevices,microphoneAvailable:"mediaDevices"in navigator&&"getUserMedia"in navigator.mediaDevices,bluetoothEnabled:"bluetooth"in navigator,notificationsEnabled:"Notification"in window&&Notification.permission==="granted"};if(m(t=>({...t,...s})),"Notification"in window&&Notification.permission==="default"){const t=await Notification.requestPermission();m(a=>({...a,notificationsEnabled:t==="granted"}))}if(s.gpsEnabled&&Q(),"getBattery"in navigator){const t=await navigator.getBattery();m(a=>({...a,batteryLevel:Math.round(t.level*100)}))}},Q=()=>{if(!navigator.geolocation)return;const s={enableHighAccuracy:!0,timeout:5e3,maximumAge:6e4};S.current=navigator.geolocation.watchPosition(t=>{const{latitude:a,longitude:g}=t.coords;q({lat:a,lon:g});const D={id:`location_${Date.now()}`,type:"location_update",data:{latitude:a,longitude:g,timestamp:new Date().toISOString()},timestamp:new Date().toISOString(),synced:n.isOnline};n.isOnline?U():y(ce=>[...ce,D])},t=>{c("GPS Error","Unable to get current location","error")},s)},Y=async()=>{const s=[{id:"notif_1",type:"info",title:"Shift Starting Soon",message:"Your shift begins in 30 minutes",timestamp:new Date().toISOString(),read:!1,actionable:!0},{id:"notif_2",type:"warning",title:"Weather Alert",message:"High winds expected in your work area",timestamp:new Date().toISOString(),read:!1,actionable:!1},{id:"notif_3",type:"success",title:"Timesheet Approved",message:"Your timesheet for last week has been approved",timestamp:new Date().toISOString(),read:!0,actionable:!1}];b(s)},K=()=>{const s=localStorage.getItem("offlineActions");s&&y(JSON.parse(s))},k=s=>{localStorage.setItem("offlineActions",JSON.stringify(s)),y(s)},O=async()=>{if(!n.isOnline||p)return;P(!0);const s=l.filter(t=>!t.synced);try{for(const a of s)await C(a);const t=l.map(a=>({...a,synced:!0}));k(t),m(a=>({...a,lastSync:new Date().toISOString()})),c("Sync Complete",`${s.length} actions synchronized`,"success")}catch{c("Sync Failed","Unable to sync offline actions","error")}finally{P(!1)}},C=async s=>{switch(s.type){case"clock_in":case"clock_out":await new Promise(t=>setTimeout(t,500));break;case"location_update":await U();break;case"photo_upload":await new Promise(t=>setTimeout(t,1e3));break}},U=async s=>{await new Promise(t=>setTimeout(t,200))},X=async()=>{const s=o?"clock_out":"clock_in",t={id:`${s}_${Date.now()}`,type:s,data:{timestamp:new Date().toISOString(),location:f},timestamp:new Date().toISOString(),synced:n.isOnline};if(n.isOnline)await C(t);else{const a=[...l,t];k(a)}F(!o),c(`Clock ${s==="clock_in"?"In":"Out"}`,`Successfully ${s==="clock_in"?"clocked in":"clocked out"}`,"success")},Z=async()=>{if(!n.cameraAvailable){c("Camera Error","Camera not available","error");return}try{const s=await navigator.mediaDevices.getUserMedia({video:!0});R(!0),setTimeout(()=>{s.getTracks().forEach(a=>a.stop()),R(!1);const t={id:`photo_${Date.now()}`,type:"photo_upload",data:{type:"receipt",timestamp:new Date().toISOString(),location:f},timestamp:new Date().toISOString(),synced:n.isOnline};if(n.isOnline)C(t);else{const a=[...l,t];k(a)}c("Photo Captured","Receipt photo saved successfully","success")},3e3)}catch{c("Camera Error","Unable to access camera","error")}},ee=async()=>{if(!n.microphoneAvailable){c("Microphone Error","Microphone not available","error");return}try{const s=await navigator.mediaDevices.getUserMedia({audio:!0});x.current=new MediaRecorder(s),x.current.start(),M(!0),x.current.ondataavailable=t=>{},setTimeout(()=>{A()},1e4)}catch{c("Microphone Error","Unable to access microphone","error")}},A=()=>{x.current&&j&&(x.current.stop(),M(!1),c("Voice Note","Voice note recorded successfully","success"))},c=(s,t,a)=>{const g={id:`notif_${Date.now()}`,type:a,title:s,message:t,timestamp:new Date().toISOString(),read:!1,actionable:!1};b(D=>[g,...D.slice(0,9)]),n.notificationsEnabled&&"Notification"in window&&new window.Notification(s,{body:t,icon:"/favicon.ico"}),re({title:s,description:t,variant:a==="error"?"destructive":"default"})},se=s=>{b(t=>t.map(a=>a.id===s?{...a,read:!0}:a))},te=[{id:"clock",name:o?"Clock Out":"Clock In",icon:oe,action:X,enabled:!0,badge:o?1:0},{id:"camera",name:"Take Photo",icon:_,action:Z,enabled:n.cameraAvailable},{id:"voice",name:j?"Stop Recording":"Voice Note",icon:W,action:j?A:ee,enabled:n.microphoneAvailable},{id:"sync",name:"Sync Data",icon:B,action:O,enabled:n.isOnline&&!p,badge:l.filter(s=>!s.synced).length}],ae=()=>n.isOnline?n.signalStrength>=3?e.jsx(L,{className:"h-4 w-4 text-green-500"}):n.signalStrength>=2?e.jsx(L,{className:"h-4 w-4 text-yellow-500"}):e.jsx(L,{className:"h-4 w-4 text-red-500"}):e.jsx(be,{className:"h-4 w-4 text-red-500"}),ne=()=>n.batteryLevel>50?"text-green-500":n.batteryLevel>20?"text-yellow-500":"text-red-500",ie=s=>{switch(s){case"success":return e.jsx(ge,{className:"h-4 w-4 text-green-500"});case"warning":return e.jsx(z,{className:"h-4 w-4 text-yellow-500"});case"error":return e.jsx(z,{className:"h-4 w-4 text-red-500"});default:return e.jsx(V,{className:"h-4 w-4 text-blue-500"})}};return u?e.jsxs("div",{className:"min-h-screen bg-gray-50 p-4 max-w-md mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded-lg mb-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[ae(),e.jsx("span",{className:"text-xs",children:n.isOnline?"Online":"Offline"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[f&&e.jsx(me,{className:"h-4 w-4 text-blue-500"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ne,{className:`h-4 w-4 ${ne()}`}),e.jsxs("span",{className:"text-xs",children:[n.batteryLevel,"%"]})]})]})]}),e.jsxs(r,{className:"mb-4",children:[e.jsx(xe,{className:"pb-2",children:e.jsxs(he,{className:"text-lg flex items-center space-x-2",children:[e.jsx($,{className:"h-5 w-5"}),e.jsx("span",{children:"Quick Actions"})]})}),e.jsx(d,{children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:te.map(s=>e.jsxs(E,{variant:s.id==="clock"&&o?"destructive":"outline",className:"relative h-16 flex-col space-y-1",onClick:s.action,disabled:!s.enabled,children:[e.jsx(s.icon,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:s.name}),s.badge&&s.badge>0&&e.jsx(h,{className:"absolute -top-1 -right-1 h-5 w-5 rounded-full p-0 text-xs",children:s.badge})]},s.id))})})]}),e.jsxs(ue,{defaultValue:"dashboard",className:"space-y-4",children:[e.jsxs(fe,{className:"grid w-full grid-cols-4",children:[e.jsx(N,{value:"dashboard",className:"text-xs",children:e.jsx($,{className:"h-4 w-4"})}),e.jsxs(N,{value:"notifications",className:"text-xs relative",children:[e.jsx(V,{className:"h-4 w-4"}),v.filter(s=>!s.read).length>0&&e.jsx(h,{className:"absolute -top-1 -right-1 h-4 w-4 rounded-full p-0 text-xs",children:v.filter(s=>!s.read).length})]}),e.jsxs(N,{value:"offline",className:"text-xs relative",children:[e.jsx(we,{className:"h-4 w-4"}),l.filter(s=>!s.synced).length>0&&e.jsx(h,{className:"absolute -top-1 -right-1 h-4 w-4 rounded-full p-0 text-xs",children:l.filter(s=>!s.synced).length})]}),e.jsx(N,{value:"settings",className:"text-xs",children:e.jsx(je,{className:"h-4 w-4"})})]}),e.jsxs(w,{value:"dashboard",className:"space-y-4",children:[e.jsx(r,{children:e.jsxs(d,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-medium",children:"Current Status"}),e.jsx(h,{variant:o?"default":"secondary",children:o?"Clocked In":"Clocked Out"})]}),o&&e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Started:"}),e.jsx("span",{children:"8:00 AM"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Duration:"}),e.jsx("span",{children:"2h 45m"})]}),f&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Location:"}),e.jsx("span",{className:"text-blue-600",children:"GPS Active"})]})]})]})}),e.jsx(r,{children:e.jsxs(d,{className:"p-4",children:[e.jsx("h3",{className:"font-medium mb-3",children:"Today's Summary"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Hours Worked:"}),e.jsx("span",{className:"font-medium",children:"6.5h"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Tasks Completed:"}),e.jsx("span",{className:"font-medium",children:"8"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Photos Taken:"}),e.jsx("span",{className:"font-medium",children:"12"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Distance Traveled:"}),e.jsx("span",{className:"font-medium",children:"15.2 mi"})]})]})]})}),e.jsx(r,{children:e.jsxs(d,{className:"p-4",children:[e.jsx("h3",{className:"font-medium mb-3",children:"Current Conditions"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold",children:"72°F"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Partly Cloudy"})]}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsx("div",{children:"Wind: 8 mph"}),e.jsx("div",{children:"Humidity: 45%"})]})]})]})})]}),e.jsx(w,{value:"notifications",className:"space-y-3",children:v.map(s=>e.jsx(r,{className:`cursor-pointer ${s.read?"opacity-60":""}`,onClick:()=>se(s.id),children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[ie(s.type),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-sm",children:s.title}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.message}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:new Date(s.timestamp).toLocaleTimeString()})]}),!s.read&&e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"})]})})},s.id))}),e.jsxs(w,{value:"offline",className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium",children:"Offline Actions"}),e.jsx(E,{size:"sm",onClick:O,disabled:!n.isOnline||p,children:p?e.jsx(B,{className:"h-4 w-4 animate-spin"}):e.jsx(ve,{className:"h-4 w-4"})})]}),l.length===0?e.jsx(r,{children:e.jsx(d,{className:"p-4 text-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"No offline actions pending"})})}):l.map(s=>e.jsx(r,{children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm capitalize",children:s.type.replace("_"," ")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(s.timestamp).toLocaleString()})]}),e.jsx(h,{variant:s.synced?"default":"secondary",children:s.synced?"Synced":"Pending"})]})})},s.id))]}),e.jsx(w,{value:"settings",className:"space-y-4",children:e.jsx(r,{children:e.jsxs(d,{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(T,{className:"text-sm font-medium",children:"GPS Tracking"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Enable location tracking"})]}),e.jsx(I,{checked:n.gpsEnabled})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(T,{className:"text-sm font-medium",children:"Push Notifications"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Receive instant alerts"})]}),e.jsx(I,{checked:n.notificationsEnabled})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(T,{className:"text-sm font-medium",children:"Auto Sync"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Sync when online"})]}),e.jsx(I,{checked:!0})]}),e.jsx("div",{className:"pt-2 border-t",children:e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Data Usage:"}),e.jsxs("span",{children:[n.dataUsage," MB"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Last Sync:"}),e.jsx("span",{children:new Date(n.lastSync).toLocaleTimeString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"App Version:"}),e.jsx("span",{children:"1.0.0"})]})]})})]})})})]}),G&&e.jsx("div",{className:"fixed inset-0 bg-black z-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-white text-center",children:[e.jsx(_,{className:"h-16 w-16 mx-auto mb-4"}),e.jsx("p",{children:"Camera is active..."}),e.jsx("p",{className:"text-sm opacity-75",children:"Taking photo in 3 seconds"})]})}),j&&e.jsxs("div",{className:"fixed bottom-4 left-4 right-4 bg-red-500 text-white p-3 rounded-lg flex items-center justify-center z-40",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"text-sm",children:"Recording voice note..."}),e.jsx(E,{size:"sm",variant:"ghost",className:"ml-4 text-white hover:bg-red-600",onClick:A,children:"Stop"})]})]}):e.jsx("div",{className:"flex items-center justify-center h-screen p-4",children:e.jsxs(r,{className:"p-8 text-center",children:[e.jsx(de,{className:"h-16 w-16 mx-auto mb-4 text-muted-foreground"}),e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Mobile Access"}),e.jsx("p",{className:"text-muted-foreground",children:"Please sign in to access mobile features"})]})})};export{Te as default};
